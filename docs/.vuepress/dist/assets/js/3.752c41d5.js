(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{318:function(e,a,t){e.exports=t.p+"assets/img/817daf704b66a572f2c3b163320abbc0508b2dd200f7dfd36ab294f58e0e19e0.e3533ad6.png"},319:function(e,a,t){e.exports=t.p+"assets/img/54fc0a9b336b290c16ebf4375808f1c6a15b8fe7f916073893680fce7077950c.38e22bbb.png"},320:function(e,a,t){e.exports=t.p+"assets/img/b217c0402e8f49361a24080b2c91e28f1a24c0b26760aaf89871ac00a0949c9e.01cd5750.png"},321:function(e,a,t){e.exports=t.p+"assets/img/ff792949fdb0d8359b1f20a1db6763d23430e8d94b58180f38be1342f8ccce0c.33b19f02.png"},322:function(e,a,t){e.exports=t.p+"assets/img/42b313a369564f02f6cc7afb400de46e6d08e6d25cf2df0802babdec3263866b.1caaebb8.png"},323:function(e,a,t){e.exports=t.p+"assets/img/f88288b384cfd27d55d410ba9015be1d1b32ed6cf060b46f73dae23f0f497fc4.49898d8d.png"},324:function(e,a,t){e.exports=t.p+"assets/img/20014d5f04411184559b7a49ca1300a9b95e867acda5b7942524f035e054a28b.0f836819.png"},325:function(e,a,t){e.exports=t.p+"assets/img/554aaa554abae4a604986b38b3fbd9900e29aa433448adcb58188a351b3a1ec7.dfacdb2f.png"},326:function(e,a,t){e.exports=t.p+"assets/img/a1cac133c49ff024b2024d1a78d2da451d1e58d3c827651e4dc62090d9e87183.488a5649.png"},327:function(e,a,t){e.exports=t.p+"assets/img/e5629dd0d0718e6844a29966eaa1be70ff69f6d540b9df73fb512a8455a1faaf.5892a7f7.png"},328:function(e,a,t){e.exports=t.p+"assets/img/5d488deee54ed0b05ffdb6fd5f5642e33bbefa4a441bb81c8a072cc681598c8e.1becf902.png"},329:function(e,a,t){e.exports=t.p+"assets/img/5d1e579c1b1b685a759be5201f47a734ee568cc012d068cd18b6b0f533927104.18804581.png"},330:function(e,a,t){e.exports=t.p+"assets/img/548d567dbab937cd2c77d9bce2e62132c91df20b2c4f027aa7871136fdf7f2ac.a95fb44a.png"},331:function(e,a,t){e.exports=t.p+"assets/img/f78cb444544a6985f61463396f626bde993a360412463d1726af53250fe548f4.82c20197.png"},332:function(e,a,t){e.exports=t.p+"assets/img/9a3fe6dce02bd6cc8484f711f949c16e42c35e84d13d4ea0ace536dc7122f750.969bde3b.png"},333:function(e,a,t){e.exports=t.p+"assets/img/48fa4dbf28e3314719f9b69e246ca7bd9f397f64311a11e799e44524aaf46dee.75964ac4.png"},334:function(e,a,t){e.exports=t.p+"assets/img/fc8073dcebc631393515945821d4c101d32b80aaea1c399e59c47eeb94ef1b68.ecb0794d.png"},335:function(e,a,t){e.exports=t.p+"assets/img/38d04db14246b8c3008d303da81563dab3ba4a2db6949d77951f550c23735e6d.d38183b9.png"},336:function(e,a,t){e.exports=t.p+"assets/img/0990f53c83bb94a02d8885a973aa6736f1de022081d874f3556ea40ff6abad83.f8b9e053.png"},337:function(e,a,t){e.exports=t.p+"assets/img/fcfe6c149194be94f11e7de6691f6de6e09593fe10f305c7dac2c1a3853251e2.197c7d78.png"},338:function(e,a,t){e.exports=t.p+"assets/img/e9789275ff88333a7d004b0d1a2833fa8cc226882ea63b830e39295e1e1b5412.424e7ba4.png"},339:function(e,a,t){e.exports=t.p+"assets/img/43bd995595b8e51e9fe3eb9a0bf133e348b01336310e92530319197e9fddd701.d5e94f17.png"},387:function(e,a,t){e.exports=t.p+"assets/img/92ade1fe984e3dded00156cbe7920d0de9d243f262b1a03c902583552ac61a03.f94908c0.png"},396:function(e,a,t){"use strict";t.r(a);var s=t(40),r=Object(s.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"memberprism-文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#memberprism-文档"}},[e._v("#")]),e._v(" MemberPrism 文档")]),e._v(" "),s("p",[s("RouterLink",{attrs:{to:"/"}},[e._v("English")])],1),e._v(" "),s("h2",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[e._v("#")]),e._v(" 简介")]),e._v(" "),s("p",[e._v("MemberPrism 是一个为现有网站、尤其是静态网站提供会员、订阅和内容保护功能的开源工具。")]),e._v(" "),s("p",[e._v("它的特色在于采用插件方式，只需要简单添加几行代码，就可以立刻完成功能的添加。同时，这些功能采用浮层的形式实现，用户不需要离开网站就可以完成以上功能。")]),e._v(" "),s("h3",{attrs:{id:"功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[e._v("#")]),e._v(" 功能")]),e._v(" "),s("p",[e._v("MemberPrism 目前提供的功能包括：")]),e._v(" "),s("ul",[s("li",[e._v("会员管理\n"),s("ul",[s("li",[e._v("注册")]),e._v(" "),s("li",[e._v("登入")]),e._v(" "),s("li",[e._v("登出")]),e._v(" "),s("li",[e._v("修改用户等级：普通用户/管理员")])])]),e._v(" "),s("li",[e._v("订阅管理\n"),s("ul",[s("li",[e._v("添加、修改、删除、停用订阅计划")]),e._v(" "),s("li",[e._v("用户通过链接订阅计划")]),e._v(" "),s("li",[e._v("用户修改、取消订阅")])])]),e._v(" "),s("li",[e._v("会员内容保护\n"),s("ul",[s("li",[e._v("添加、修改、删除、停用会员内容")]),e._v(" "),s("li",[e._v("为订阅计划分配会员内容")]),e._v(" "),s("li",[e._v("通过 JavaScript 进行会员内容的前端保护")]),e._v(" "),s("li",[e._v("通过 MemberProxy 进行会员内容的后端保护")])])])]),e._v(" "),s("h3",{attrs:{id:"截图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#截图"}},[e._v("#")]),e._v(" 截图")]),e._v(" "),s("p",[s("img",{attrs:{src:t(318),alt:"picture 15"}})]),e._v(" "),s("p",[s("img",{attrs:{src:t(319),alt:"picture 16"}})]),e._v(" "),s("p",[s("img",{attrs:{src:t(320),alt:"picture 17"}})]),e._v(" "),s("p",[s("img",{attrs:{src:t(321),alt:"picture 18"}})]),e._v(" "),s("p",[s("img",{attrs:{src:t(322),alt:"picture 19"}})]),e._v(" "),s("p",[s("img",{attrs:{src:t(323),alt:"picture 20"}})]),e._v(" "),s("p",[s("img",{attrs:{src:t(324),alt:"picture 21"}})]),e._v(" "),s("p",[s("img",{attrs:{src:t(325),alt:"picture 22"}})]),e._v(" "),s("p",[s("img",{attrs:{src:t(326),alt:"picture 23"}})]),e._v(" "),s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),s("h3",{attrs:{id:"通过-docker-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过-docker-安装"}},[e._v("#")]),e._v(" 通过 Docker 安装")]),e._v(" "),s("p",[e._v("为了方便安装，我们提供了 Docker 安装方式。也推荐优先使用本方式。")]),e._v(" "),s("h4",{attrs:{id:"依赖环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#依赖环境"}},[e._v("#")]),e._v(" 依赖环境")]),e._v(" "),s("p",[e._v("首先，你需要一个支持 "),s("code",[e._v("git")]),e._v(" 和 "),s("code",[e._v("docker-compose")]),e._v(" 的容器环境，如果还没有安装，可以参考"),s("a",{attrs:{href:"https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-compose-on-ubuntu-20-04",target:"_blank",rel:"noopener noreferrer"}},[e._v("这篇文章"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("h4",{attrs:{id:"初始化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[e._v("#")]),e._v(" 初始化")]),e._v(" "),s("p",[e._v("首先通过 clone 本项目代码")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone https://github.com/easychen/member-prism.git prism\n")])])]),s("p",[e._v("进入目录，通过 "),s("code",[e._v("docker-compose")]),e._v(" 启动服务")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v("  prism "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" docker-compose up -d\n")])])]),s("p",[e._v("服务将启动两个端口：")]),e._v(" "),s("ul",[s("li",[e._v("8801：MemberPrism，网站")]),e._v(" "),s("li",[e._v("8802: MemberProxy，启用后端保护时，用户将访问这里")])]),e._v(" "),s("p",[e._v("可以通过修改根目录下的 "),s("code",[e._v("docker-compose.yaml")]),e._v(" 中 "),s("code",[e._v("port")]),e._v(" 部分调整这个两个服务的端口：")]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'8801:80'")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'8802:8802'")]),e._v("\n")])])]),s("h5",{attrs:{id:"https-支持"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#https-支持"}},[e._v("#")]),e._v(" HTTPS 支持")]),e._v(" "),s("p",[e._v("首先，将证书放入 "),s("code",[e._v("ssl")]),e._v(" 目录下。")]),e._v(" "),s("p",[e._v("打开 "),s("code",[e._v("docker/web/vhost.conf")]),e._v("，去掉以下行之前的注释：")]),e._v(" "),s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("SSLEngine             on\nSSLCertificateFile    /app/ssl/server.crt\nSSLCertificateKeyFile /app/ssl/server.key\n")])])]),s("p",[e._v("打开 "),s("code",[e._v("web/.env")]),e._v(" 修改 "),s("code",[e._v("PRISM_HTTPS")]),e._v(" 为 "),s("code",[e._v("true")]),e._v("：")]),e._v(" "),s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("PRISM_HTTPS=true\n")])])]),s("h3",{attrs:{id:"手动安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手动安装"}},[e._v("#")]),e._v(" 手动安装")]),e._v(" "),s("p",[e._v("MemberPrism 的主程序部分采用 Laravel 编写，熟悉 Laravel 的开发者可以很容易地进行搭建。")]),e._v(" "),s("p",[e._v("进入 web 目录")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /app/web \n")])])]),s("p",[e._v("通过 compser 安装依赖")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("composer")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" \n")])])]),s("p",[e._v("复制 "),s("code",[e._v(".env.example")]),e._v(" 为 "),s("code",[e._v(".env")]),e._v("，并根据具体情况进行修改。")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" .env.example .env \n")])])]),s("p",[e._v("生成 app key")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("php artisan key:generate \n")])])]),s("p",[e._v("初始化数据库并填入默认账号")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("php artisan migrate --seed\n")])])]),s("p",[e._v("需要确认以下目录可写入权限，可以改为 755 或者 777。")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("chmod")]),e._v(" -R 0777 /app/web/storage\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("chmod")]),e._v(" -R 0777 /app/web/bootstrap/cache/\n")])])]),s("p",[e._v("启动 proxy")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /app/proxy "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" ./server-linux "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("\n")])])]),s("p",[e._v("如果是 Mac 环境，请使用")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /app/proxy "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" ./server-mac "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("\n")])])]),s("h2",{attrs:{id:"为网站添加功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为网站添加功能"}},[e._v("#")]),e._v(" 为网站添加功能")]),e._v(" "),s("p",[e._v("首先明确以下名词：")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("TargetSite")]),e._v("：需要添加会员和订阅功能的网站")]),e._v(" "),s("li",[s("code",[e._v("PrismSite")]),e._v(": 默认 "),s("code",[e._v("8801")]),e._v(" 端口对应的主网站")]),e._v(" "),s("li",[s("code",[e._v("ProxySite")]),e._v(": 默认 "),s("code",[e._v("8802")]),e._v(" 端口对应的代理网站")])]),e._v(" "),s("p",[e._v("安装完成后，访问 "),s("code",[e._v("<ip>:8801")]),e._v(" 即可进入 "),s("code",[e._v("PrismSite")]),e._v("。")]),e._v(" "),s("h3",{attrs:{id:"管理账号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#管理账号"}},[e._v("#")]),e._v(" 管理账号")]),e._v(" "),s("p",[e._v("使用以下账号登入：")]),e._v(" "),s("ul",[s("li",[e._v("用户名： "),s("code",[e._v("admin@memberprism.com")])]),e._v(" "),s("li",[e._v("密码："),s("code",[e._v("admin")])])]),e._v(" "),s("p",[e._v("登入后，进入 "),s("code",[e._v("members")]),e._v(" 页面，点击 "),s("code",[e._v("level")]),e._v(" 可以修改用户的等级。\n"),s("img",{attrs:{src:t(327),alt:"p1"}})]),e._v(" "),s("h3",{attrs:{id:"配置网址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置网址"}},[e._v("#")]),e._v(" 配置网址")]),e._v(" "),s("p",[e._v("进入 "),s("code",[e._v("Settings")]),e._v(" 页面，设置"),s("code",[e._v("PrismSite")]),e._v("网站的名称、网址。此网址最后需要"),s("code",[e._v("TargetSite")]),e._v("的用户可以访问。")]),e._v(" "),s("p",[s("img",{attrs:{src:t(328),alt:"p3"}})]),e._v(" "),s("h3",{attrs:{id:"获得安装代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获得安装代码"}},[e._v("#")]),e._v(" 获得安装代码")]),e._v(" "),s("p",[e._v("进入 "),s("code",[e._v("Links")]),e._v(" 页面，复制 "),s("code",[e._v("Head scripts")]),e._v(" 并粘贴到"),s("code",[e._v("TargetSite")]),e._v("网站页面的 "),s("code",[e._v("<head>")]),e._v(" 标签中。注意，希望用到MemberPrism功能的网页都需要添加这段代码。")]),e._v(" "),s("p",[s("img",{attrs:{src:t(329),alt:"p2"}})]),e._v(" "),s("h3",{attrs:{id:"复制功能链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#复制功能链接"}},[e._v("#")]),e._v(" 复制功能链接")]),e._v(" "),s("p",[e._v("在 "),s("code",[e._v("Links")]),e._v(" 页面下方，有"),s("code",[e._v("登入")]),e._v("用的 URL，可复制后粘贴到 "),s("code",[e._v("TargetSite")]),e._v(" 中对应的链接中。")]),e._v(" "),s("p",[e._v("代码形如：")]),e._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("a")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("#prism-ajax-login"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("Login"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("</")]),e._v("a")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n")])])]),s("p",[e._v("点击后，效果如图：")]),e._v(" "),s("p",[s("img",{attrs:{src:t(330),alt:"picture 4"}})]),e._v(" "),s("p",[e._v("添加完 "),s("code",[e._v("注册")]),e._v("、"),s("code",[e._v("个人资料")]),e._v("等链接后，此网站就具有了用户系统。")]),e._v(" "),s("h2",{attrs:{id:"订阅配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#订阅配置"}},[e._v("#")]),e._v(" 订阅配置")]),e._v(" "),s("p",[e._v("MemberPrism 使用 "),s("a",{attrs:{href:"https://stripe.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("Stripe"),s("OutboundLink")],1),e._v(" 来实现支付和订阅相关功能。这需要你先注册一个 Stripe 账号。")]),e._v(" "),s("p",[e._v("以下以 "),s("code",[e._v("test mode")]),e._v(" 为例进行说明。")]),e._v(" "),s("h3",{attrs:{id:"配置-stripe-key"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-stripe-key"}},[e._v("#")]),e._v(" 配置 Stripe Key")]),e._v(" "),s("p",[e._v("打开 "),s("code",[e._v("Developers")]),e._v(" 菜单下的 "),s("a",{attrs:{href:"https://dashboard.stripe.com/test/apikeys",target:"_blank",rel:"noopener noreferrer"}},[e._v("API Keys页面"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("p",[s("img",{attrs:{src:t(331),alt:"picture 5"}})]),e._v(" "),s("p",[e._v("复制对应的 Key，并填入 "),s("code",[e._v("PrismSite")]),e._v(" 的 "),s("code",[e._v("Settings")]),e._v(" 中的对应选项：")]),e._v(" "),s("p",[s("img",{attrs:{src:t(332),alt:"picture 6"}})]),e._v(" "),s("h3",{attrs:{id:"创建-price-id"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建-price-id"}},[e._v("#")]),e._v(" 创建 Price ID")]),e._v(" "),s("p",[e._v("进入 Stripe dashboard，创建一个 "),s("a",{attrs:{href:"https://dashboard.stripe.com/test/products/create",target:"_blank",rel:"noopener noreferrer"}},[e._v("product"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("p",[e._v("注意在 Pricing 部分，选择 Recurring ，这样才能自动续费。其他的项按自己的需求填写即可。")]),e._v(" "),s("p",[s("img",{attrs:{src:t(333),alt:"picture 7"}})]),e._v(" "),s("p",[e._v("创建完成后，进入该 product 详情页面，可以看到  Pricing 一节中的 API ID，将其记录下来。")]),e._v(" "),s("p",[s("img",{attrs:{src:t(334),alt:"picture 8"}})]),e._v(" "),s("p",[e._v("根据自己的需要，可创建多个 price ，各个等级的订阅、按月和按年支付，都应该是不同的 price id 。这些 price id 需要记录下来，稍后创建订阅计划时需要用到。")]),e._v(" "),s("h3",{attrs:{id:"创建订阅计划"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建订阅计划"}},[e._v("#")]),e._v(" 创建订阅计划")]),e._v(" "),s("p",[e._v("回到 "),s("code",[e._v("PrismSite")]),e._v(" 后台，进入 "),s("code",[e._v("Plans")]),e._v(" 页面，创建一个 "),s("code",[e._v("Plan")]),e._v("。这里需要的 "),s("code",[e._v("price id")]),e._v(" 就是上文创建的那些。")]),e._v(" "),s("p",[s("img",{attrs:{src:t(335),alt:"picture 9"}})]),e._v(" "),s("p",[e._v("依次填入 "),s("code",[e._v("price id")]),e._v("，创建多个 "),s("code",[e._v("Plan")]),e._v("。")]),e._v(" "),s("p",[e._v("这时候回到 "),s("code",[e._v("Links")]),e._v(" 页面，在最下方可以看到刚才创建 "),s("code",[e._v("plan")]),e._v(" 的订阅链接。")]),e._v(" "),s("p",[s("img",{attrs:{src:t(336),alt:"picture 10"}})]),e._v(" "),s("p",[e._v("将这些链接添加到 "),s("code",[e._v("TargetSite")]),e._v(" 中对应的地方，用户点击后将转向支付页面。（未登入用户会显示登入界面）")]),e._v(" "),s("h3",{attrs:{id:"会员可见内容保护"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#会员可见内容保护"}},[e._v("#")]),e._v(" 会员可见内容保护")]),e._v(" "),s("p",[e._v("假设在 "),s("code",[e._v("TargetSite")]),e._v(" 的 URL 为 "),s("code",[e._v("http://t.com/")]),e._v("，会员可见内容放到 "),s("code",[e._v("vip")]),e._v(" 目录下。现在没有保护，可以直接通过 "),s("code",[e._v("http://t.com/vip/some.html")]),e._v("进行访问。")]),e._v(" "),s("p",[e._v("下边我们将这个目录保护起来。")]),e._v(" "),s("p",[e._v("进入 "),s("code",[e._v("PrismSite")]),e._v(" 的 "),s("code",[e._v("Content")]),e._v(" 页面，创建一个 "),s("code",[e._v("content")]),e._v("。")]),e._v(" "),s("ul",[s("li",[e._v("Folder or pages URL：保护的目录或者网页，在上边的例子中，填入 "),s("code",[e._v("/vip")])]),e._v(" "),s("li",[e._v("Match type：StartWith 指网址中只要以 "),s("code",[e._v("/vip")]),e._v(" 开头，都进行保护；Exact 指精确匹配")]),e._v(" "),s("li",[e._v("Redirect for non-members：当非会员访问时，转向的说明页面。一般是订阅的销售页面。")])]),e._v(" "),s("p",[s("img",{attrs:{src:t(337),alt:"picture 11"}})]),e._v(" "),s("h3",{attrs:{id:"为订阅计划分配内容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为订阅计划分配内容"}},[e._v("#")]),e._v(" 为订阅计划分配内容")]),e._v(" "),s("p",[e._v("进入 "),s("code",[e._v("PrismSite")]),e._v(" 的 "),s("code",[e._v("Plans")]),e._v(" 页面，可以为订阅计划分配会员可见内容。点击列表中 "),s("code",[e._v("Contents")]),e._v(" 列的编辑图标，可以选择此计划的会员可以阅读哪些内容。")]),e._v(" "),s("p",[s("img",{attrs:{src:t(338),alt:"picture 12"}})]),e._v(" "),s("p",[e._v("这里的 Content 可以多选，按住 Shift /Alt 可以选择多个。")]),e._v(" "),s("p",[s("img",{attrs:{src:t(387),alt:"picture 13"}})]),e._v(" "),s("p",[e._v("保存后，前端保护将实时生效。后端保护将在用户登入过期后（默认为两天）生效。")]),e._v(" "),s("p",[e._v("修改 "),s("code",[e._v("web/.env")]),e._v(" 中的"),s("code",[e._v("PRISM_MEMBER_EXPIRE_DAYS")]),e._v(" 设置，可以对过期时间进行修改。")]),e._v(" "),s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("PRISM_MEMBER_EXPIRE_DAYS=2\n")])])]),s("h2",{attrs:{id:"后端保护"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#后端保护"}},[e._v("#")]),e._v(" 后端保护")]),e._v(" "),s("h3",{attrs:{id:"原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[e._v("#")]),e._v(" 原理")]),e._v(" "),s("p",[e._v("前端保护的原理是，我们为 "),s("code",[e._v("TargetSite")]),e._v(" 添加了一些 JavaScript 代码，这些代码会定时检查，当用户访问到被保护的 URL ，而且又不是会员时，我们让浏览器跳转到其他页面。这样就实现了保护。")]),e._v(" "),s("p",[e._v("但实际上，内容其实已经到了浏览器中，只是没有显示，或者说显示的时间很短而已。通过查看 HTML 等方式，实际上是可以找到这些内容的。")]),e._v(" "),s("p",[e._v("为了支持需要更为严格的保护用户内容的场景，MemberPrism 提供了基于代理的后端保护。")]),e._v(" "),s("p",[e._v("后端保护的原理是，原来用户访问 "),s("code",[e._v("TargetSite")]),e._v("，现在改为访问 "),s("code",[e._v("ProxySite")]),e._v("，不再直接访问"),s("code",[e._v("TargetSite")]),e._v("。"),s("code",[e._v("ProxySite")]),e._v(" 会先检查用户是否在访问会员内容，以及是否会员。如果权限不够，直接让其转向。")]),e._v(" "),s("p",[e._v("区别在于，后端保护方案中，会员内容不会发送到浏览器，从而实现了真正意义上的保护。")]),e._v(" "),s("h3",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[e._v("#")]),e._v(" 使用")]),e._v(" "),s("p",[e._v("进入 "),s("code",[e._v("PrismSite")]),e._v(" 的 "),s("code",[e._v("Settings")]),e._v(" 页面，拉到最下方。")]),e._v(" "),s("p",[e._v("在 "),s("code",[e._v("Source site URL")]),e._v(" 中填入 "),s("code",[e._v("TargetSite")]),e._v(" 的 URL，在 "),s("code",[e._v("Proxy site URL")]),e._v(" 中填入"),s("code",[e._v("ProxySite")]),e._v("  的 URL（也就是最终用户访问的 URL）。")]),e._v(" "),s("p",[e._v("在支付等环节成功后，页面将重定向到 "),s("code",[e._v("Proxy site URL")]),e._v("，所以务必要正确填写。")]),e._v(" "),s("p",[s("img",{attrs:{src:t(339),alt:"picture 14"}})]),e._v(" "),s("p",[e._v("填写完成后，点击 "),s("code",[e._v("Save")]),e._v(" 保存。页面刷新后，再点击 "),s("code",[e._v("Update proxy settings")]),e._v(" 生成代理用的设置。以后每次更新代理相关功能，都需要手工点击一次。")]),e._v(" "),s("p",[e._v("如果配置正确，用户应该可以通过 "),s("code",[e._v("Proxy site URL")]),e._v(" 正常使用了。")]),e._v(" "),s("h3",{attrs:{id:"安全"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安全"}},[e._v("#")]),e._v(" 安全")]),e._v(" "),s("p",[e._v("在前边的配置中，"),s("code",[e._v("TargetSite")]),e._v(" 和 "),s("code",[e._v("ProxySite")]),e._v(" 是可以同时被访问的。知道"),s("code",[e._v("TargetSite")]),e._v("网址的用户可能绕开后端保护。")]),e._v(" "),s("p",[e._v("这里我们只需要给 "),s("code",[e._v("TargetSite")]),e._v(" 加上 IP 访问限制，比如让其只能被 "),s("code",[e._v("ProxySite")]),e._v(" 的 IP 访问，就可以防范以上的潜在问题。")]),e._v(" "),s("h2",{attrs:{id:"更多"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更多"}},[e._v("#")]),e._v(" 更多")]),e._v(" "),s("h3",{attrs:{id:"关于作者"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于作者"}},[e._v("#")]),e._v(" 关于作者")]),e._v(" "),s("ul",[s("li",[e._v("个人主页："),s("a",{attrs:{href:"https://ftqq.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://ftqq.com"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("微博："),s("a",{attrs:{href:"https://weibo.com/easy",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://weibo.com/easy"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("Twitter："),s("a",{attrs:{href:"https://twitter.com/easychen",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://twitter.com/easychen"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);