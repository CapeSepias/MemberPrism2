<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MemberPrism 文档 | MemberPrism</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="类似 memberstack 或 memberspace 的开源实现，但对会员内容同时提供了前端和后端的双重保护">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.216dffaf.js" as="script"><link rel="preload" href="/assets/js/2.abbacd5f.js" as="script"><link rel="preload" href="/assets/js/3.752c41d5.js" as="script"><link rel="prefetch" href="/assets/js/4.5e253ff5.js"><link rel="prefetch" href="/assets/js/5.f7ea1688.js"><link rel="prefetch" href="/assets/js/6.a65e5dd2.js"><link rel="prefetch" href="/assets/js/7.1eab93e4.js"><link rel="prefetch" href="/assets/js/8.4e522548.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" aria-current="page" class="home-link router-link-exact-active router-link-active"><!----> <span class="site-name">MemberPrism</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/easychen/member-prism" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  en-US
</a></li><li class="dropdown-item"><!----> <a href="/zh/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  zh-CN
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/easychen/member-prism" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  en-US
</a></li><li class="dropdown-item"><!----> <a href="/zh/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  zh-CN
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MemberPrism 文档</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/#简介" class="sidebar-link">简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/#功能" class="sidebar-link">功能</a></li><li class="sidebar-sub-header"><a href="/zh/#截图" class="sidebar-link">截图</a></li></ul></li><li><a href="/zh/#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/#通过-docker-安装" class="sidebar-link">通过 Docker 安装</a></li><li class="sidebar-sub-header"><a href="/zh/#手动安装" class="sidebar-link">手动安装</a></li></ul></li><li><a href="/zh/#为网站添加功能" class="sidebar-link">为网站添加功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/#管理账号" class="sidebar-link">管理账号</a></li><li class="sidebar-sub-header"><a href="/zh/#配置网址" class="sidebar-link">配置网址</a></li><li class="sidebar-sub-header"><a href="/zh/#获得安装代码" class="sidebar-link">获得安装代码</a></li><li class="sidebar-sub-header"><a href="/zh/#复制功能链接" class="sidebar-link">复制功能链接</a></li></ul></li><li><a href="/zh/#订阅配置" class="sidebar-link">订阅配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/#配置-stripe-key" class="sidebar-link">配置 Stripe Key</a></li><li class="sidebar-sub-header"><a href="/zh/#创建-price-id" class="sidebar-link">创建 Price ID</a></li><li class="sidebar-sub-header"><a href="/zh/#创建订阅计划" class="sidebar-link">创建订阅计划</a></li><li class="sidebar-sub-header"><a href="/zh/#会员可见内容保护" class="sidebar-link">会员可见内容保护</a></li><li class="sidebar-sub-header"><a href="/zh/#为订阅计划分配内容" class="sidebar-link">为订阅计划分配内容</a></li></ul></li><li><a href="/zh/#后端保护" class="sidebar-link">后端保护</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header"><a href="/zh/#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/zh/#安全" class="sidebar-link">安全</a></li></ul></li><li><a href="/zh/#更多" class="sidebar-link">更多</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/#关于作者" class="sidebar-link">关于作者</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="memberprism-文档"><a href="#memberprism-文档" class="header-anchor">#</a> MemberPrism 文档</h1> <p><a href="/" class="router-link-active">English</a></p> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p>MemberPrism 是一个为现有网站、尤其是静态网站提供会员、订阅和内容保护功能的开源工具。</p> <p>它的特色在于采用插件方式，只需要简单添加几行代码，就可以立刻完成功能的添加。同时，这些功能采用浮层的形式实现，用户不需要离开网站就可以完成以上功能。</p> <h3 id="功能"><a href="#功能" class="header-anchor">#</a> 功能</h3> <p>MemberPrism 目前提供的功能包括：</p> <ul><li>会员管理
<ul><li>注册</li> <li>登入</li> <li>登出</li> <li>修改用户等级：普通用户/管理员</li></ul></li> <li>订阅管理
<ul><li>添加、修改、删除、停用订阅计划</li> <li>用户通过链接订阅计划</li> <li>用户修改、取消订阅</li></ul></li> <li>会员内容保护
<ul><li>添加、修改、删除、停用会员内容</li> <li>为订阅计划分配会员内容</li> <li>通过 JavaScript 进行会员内容的前端保护</li> <li>通过 MemberProxy 进行会员内容的后端保护</li></ul></li></ul> <h3 id="截图"><a href="#截图" class="header-anchor">#</a> 截图</h3> <p><img src="/assets/img/817daf704b66a572f2c3b163320abbc0508b2dd200f7dfd36ab294f58e0e19e0.e3533ad6.png" alt="picture 15"></p> <p><img src="/assets/img/54fc0a9b336b290c16ebf4375808f1c6a15b8fe7f916073893680fce7077950c.38e22bbb.png" alt="picture 16"></p> <p><img src="/assets/img/b217c0402e8f49361a24080b2c91e28f1a24c0b26760aaf89871ac00a0949c9e.01cd5750.png" alt="picture 17"></p> <p><img src="/assets/img/ff792949fdb0d8359b1f20a1db6763d23430e8d94b58180f38be1342f8ccce0c.33b19f02.png" alt="picture 18"></p> <p><img src="/assets/img/42b313a369564f02f6cc7afb400de46e6d08e6d25cf2df0802babdec3263866b.1caaebb8.png" alt="picture 19"></p> <p><img src="/assets/img/f88288b384cfd27d55d410ba9015be1d1b32ed6cf060b46f73dae23f0f497fc4.49898d8d.png" alt="picture 20"></p> <p><img src="/assets/img/20014d5f04411184559b7a49ca1300a9b95e867acda5b7942524f035e054a28b.0f836819.png" alt="picture 21"></p> <p><img src="/assets/img/554aaa554abae4a604986b38b3fbd9900e29aa433448adcb58188a351b3a1ec7.dfacdb2f.png" alt="picture 22"></p> <p><img src="/assets/img/a1cac133c49ff024b2024d1a78d2da451d1e58d3c827651e4dc62090d9e87183.488a5649.png" alt="picture 23"></p> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <h3 id="通过-docker-安装"><a href="#通过-docker-安装" class="header-anchor">#</a> 通过 Docker 安装</h3> <p>为了方便安装，我们提供了 Docker 安装方式。也推荐优先使用本方式。</p> <h4 id="依赖环境"><a href="#依赖环境" class="header-anchor">#</a> 依赖环境</h4> <p>首先，你需要一个支持 <code>git</code> 和 <code>docker-compose</code> 的容器环境，如果还没有安装，可以参考<a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-compose-on-ubuntu-20-04" target="_blank" rel="noopener noreferrer">这篇文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h4> <p>首先通过 clone 本项目代码</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/easychen/member-prism.git prism
</code></pre></div><p>进入目录，通过 <code>docker-compose</code> 启动服务</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span>  prism <span class="token operator">&amp;&amp;</span> docker-compose up -d
</code></pre></div><p>服务将启动两个端口：</p> <ul><li>8801：MemberPrism，网站</li> <li>8802: MemberProxy，启用后端保护时，用户将访问这里</li></ul> <p>可以通过修改根目录下的 <code>docker-compose.yaml</code> 中 <code>port</code> 部分调整这个两个服务的端口：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">'8801:80'</span>
    <span class="token punctuation">-</span> <span class="token string">'8802:8802'</span>
</code></pre></div><h5 id="https-支持"><a href="#https-支持" class="header-anchor">#</a> HTTPS 支持</h5> <p>首先，将证书放入 <code>ssl</code> 目录下。</p> <p>打开 <code>docker/web/vhost.conf</code>，去掉以下行之前的注释：</p> <div class="language-conf extra-class"><pre class="language-text"><code>SSLEngine             on
SSLCertificateFile    /app/ssl/server.crt
SSLCertificateKeyFile /app/ssl/server.key
</code></pre></div><p>打开 <code>web/.env</code> 修改 <code>PRISM_HTTPS</code> 为 <code>true</code>：</p> <div class="language-conf extra-class"><pre class="language-text"><code>PRISM_HTTPS=true
</code></pre></div><h3 id="手动安装"><a href="#手动安装" class="header-anchor">#</a> 手动安装</h3> <p>MemberPrism 的主程序部分采用 Laravel 编写，熟悉 Laravel 的开发者可以很容易地进行搭建。</p> <p>进入 web 目录</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /app/web 
</code></pre></div><p>通过 compser 安装依赖</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">composer</span> <span class="token function">install</span> 
</code></pre></div><p>复制 <code>.env.example</code> 为 <code>.env</code>，并根据具体情况进行修改。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cp</span> .env.example .env 
</code></pre></div><p>生成 app key</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan key:generate 
</code></pre></div><p>初始化数据库并填入默认账号</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan migrate --seed
</code></pre></div><p>需要确认以下目录可写入权限，可以改为 755 或者 777。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">chmod</span> -R 0777 /app/web/storage
<span class="token function">chmod</span> -R 0777 /app/web/bootstrap/cache/
</code></pre></div><p>启动 proxy</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /app/proxy <span class="token operator">&amp;&amp;</span> ./server-linux <span class="token operator">&amp;</span>
</code></pre></div><p>如果是 Mac 环境，请使用</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /app/proxy <span class="token operator">&amp;&amp;</span> ./server-mac <span class="token operator">&amp;</span>
</code></pre></div><h2 id="为网站添加功能"><a href="#为网站添加功能" class="header-anchor">#</a> 为网站添加功能</h2> <p>首先明确以下名词：</p> <ul><li><code>TargetSite</code>：需要添加会员和订阅功能的网站</li> <li><code>PrismSite</code>: 默认 <code>8801</code> 端口对应的主网站</li> <li><code>ProxySite</code>: 默认 <code>8802</code> 端口对应的代理网站</li></ul> <p>安装完成后，访问 <code>&lt;ip&gt;:8801</code> 即可进入 <code>PrismSite</code>。</p> <h3 id="管理账号"><a href="#管理账号" class="header-anchor">#</a> 管理账号</h3> <p>使用以下账号登入：</p> <ul><li>用户名： <code>admin@memberprism.com</code></li> <li>密码：<code>admin</code></li></ul> <p>登入后，进入 <code>members</code> 页面，点击 <code>level</code> 可以修改用户的等级。
<img src="/assets/img/e5629dd0d0718e6844a29966eaa1be70ff69f6d540b9df73fb512a8455a1faaf.5892a7f7.png" alt="p1"></p> <h3 id="配置网址"><a href="#配置网址" class="header-anchor">#</a> 配置网址</h3> <p>进入 <code>Settings</code> 页面，设置<code>PrismSite</code>网站的名称、网址。此网址最后需要<code>TargetSite</code>的用户可以访问。</p> <p><img src="/assets/img/5d488deee54ed0b05ffdb6fd5f5642e33bbefa4a441bb81c8a072cc681598c8e.1becf902.png" alt="p3"></p> <h3 id="获得安装代码"><a href="#获得安装代码" class="header-anchor">#</a> 获得安装代码</h3> <p>进入 <code>Links</code> 页面，复制 <code>Head scripts</code> 并粘贴到<code>TargetSite</code>网站页面的 <code>&lt;head&gt;</code> 标签中。注意，希望用到MemberPrism功能的网页都需要添加这段代码。</p> <p><img src="/assets/img/5d1e579c1b1b685a759be5201f47a734ee568cc012d068cd18b6b0f533927104.18804581.png" alt="p2"></p> <h3 id="复制功能链接"><a href="#复制功能链接" class="header-anchor">#</a> 复制功能链接</h3> <p>在 <code>Links</code> 页面下方，有<code>登入</code>用的 URL，可复制后粘贴到 <code>TargetSite</code> 中对应的链接中。</p> <p>代码形如：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#prism-ajax-login<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>点击后，效果如图：</p> <p><img src="/assets/img/548d567dbab937cd2c77d9bce2e62132c91df20b2c4f027aa7871136fdf7f2ac.a95fb44a.png" alt="picture 4"></p> <p>添加完 <code>注册</code>、<code>个人资料</code>等链接后，此网站就具有了用户系统。</p> <h2 id="订阅配置"><a href="#订阅配置" class="header-anchor">#</a> 订阅配置</h2> <p>MemberPrism 使用 <a href="https://stripe.com" target="_blank" rel="noopener noreferrer">Stripe<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来实现支付和订阅相关功能。这需要你先注册一个 Stripe 账号。</p> <p>以下以 <code>test mode</code> 为例进行说明。</p> <h3 id="配置-stripe-key"><a href="#配置-stripe-key" class="header-anchor">#</a> 配置 Stripe Key</h3> <p>打开 <code>Developers</code> 菜单下的 <a href="https://dashboard.stripe.com/test/apikeys" target="_blank" rel="noopener noreferrer">API Keys页面<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p><img src="/assets/img/f78cb444544a6985f61463396f626bde993a360412463d1726af53250fe548f4.82c20197.png" alt="picture 5"></p> <p>复制对应的 Key，并填入 <code>PrismSite</code> 的 <code>Settings</code> 中的对应选项：</p> <p><img src="/assets/img/9a3fe6dce02bd6cc8484f711f949c16e42c35e84d13d4ea0ace536dc7122f750.969bde3b.png" alt="picture 6"></p> <h3 id="创建-price-id"><a href="#创建-price-id" class="header-anchor">#</a> 创建 Price ID</h3> <p>进入 Stripe dashboard，创建一个 <a href="https://dashboard.stripe.com/test/products/create" target="_blank" rel="noopener noreferrer">product<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>注意在 Pricing 部分，选择 Recurring ，这样才能自动续费。其他的项按自己的需求填写即可。</p> <p><img src="/assets/img/48fa4dbf28e3314719f9b69e246ca7bd9f397f64311a11e799e44524aaf46dee.75964ac4.png" alt="picture 7"></p> <p>创建完成后，进入该 product 详情页面，可以看到  Pricing 一节中的 API ID，将其记录下来。</p> <p><img src="/assets/img/fc8073dcebc631393515945821d4c101d32b80aaea1c399e59c47eeb94ef1b68.ecb0794d.png" alt="picture 8"></p> <p>根据自己的需要，可创建多个 price ，各个等级的订阅、按月和按年支付，都应该是不同的 price id 。这些 price id 需要记录下来，稍后创建订阅计划时需要用到。</p> <h3 id="创建订阅计划"><a href="#创建订阅计划" class="header-anchor">#</a> 创建订阅计划</h3> <p>回到 <code>PrismSite</code> 后台，进入 <code>Plans</code> 页面，创建一个 <code>Plan</code>。这里需要的 <code>price id</code> 就是上文创建的那些。</p> <p><img src="/assets/img/38d04db14246b8c3008d303da81563dab3ba4a2db6949d77951f550c23735e6d.d38183b9.png" alt="picture 9"></p> <p>依次填入 <code>price id</code>，创建多个 <code>Plan</code>。</p> <p>这时候回到 <code>Links</code> 页面，在最下方可以看到刚才创建 <code>plan</code> 的订阅链接。</p> <p><img src="/assets/img/0990f53c83bb94a02d8885a973aa6736f1de022081d874f3556ea40ff6abad83.f8b9e053.png" alt="picture 10"></p> <p>将这些链接添加到 <code>TargetSite</code> 中对应的地方，用户点击后将转向支付页面。（未登入用户会显示登入界面）</p> <h3 id="会员可见内容保护"><a href="#会员可见内容保护" class="header-anchor">#</a> 会员可见内容保护</h3> <p>假设在 <code>TargetSite</code> 的 URL 为 <code>http://t.com/</code>，会员可见内容放到 <code>vip</code> 目录下。现在没有保护，可以直接通过 <code>http://t.com/vip/some.html</code>进行访问。</p> <p>下边我们将这个目录保护起来。</p> <p>进入 <code>PrismSite</code> 的 <code>Content</code> 页面，创建一个 <code>content</code>。</p> <ul><li>Folder or pages URL：保护的目录或者网页，在上边的例子中，填入 <code>/vip</code></li> <li>Match type：StartWith 指网址中只要以 <code>/vip</code> 开头，都进行保护；Exact 指精确匹配</li> <li>Redirect for non-members：当非会员访问时，转向的说明页面。一般是订阅的销售页面。</li></ul> <p><img src="/assets/img/fcfe6c149194be94f11e7de6691f6de6e09593fe10f305c7dac2c1a3853251e2.197c7d78.png" alt="picture 11"></p> <h3 id="为订阅计划分配内容"><a href="#为订阅计划分配内容" class="header-anchor">#</a> 为订阅计划分配内容</h3> <p>进入 <code>PrismSite</code> 的 <code>Plans</code> 页面，可以为订阅计划分配会员可见内容。点击列表中 <code>Contents</code> 列的编辑图标，可以选择此计划的会员可以阅读哪些内容。</p> <p><img src="/assets/img/e9789275ff88333a7d004b0d1a2833fa8cc226882ea63b830e39295e1e1b5412.424e7ba4.png" alt="picture 12"></p> <p>这里的 Content 可以多选，按住 Shift /Alt 可以选择多个。</p> <p><img src="/assets/img/92ade1fe984e3dded00156cbe7920d0de9d243f262b1a03c902583552ac61a03.f94908c0.png" alt="picture 13"></p> <p>保存后，前端保护将实时生效。后端保护将在用户登入过期后（默认为两天）生效。</p> <p>修改 <code>web/.env</code> 中的<code>PRISM_MEMBER_EXPIRE_DAYS</code> 设置，可以对过期时间进行修改。</p> <div class="language-conf extra-class"><pre class="language-text"><code>PRISM_MEMBER_EXPIRE_DAYS=2
</code></pre></div><h2 id="后端保护"><a href="#后端保护" class="header-anchor">#</a> 后端保护</h2> <h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p>前端保护的原理是，我们为 <code>TargetSite</code> 添加了一些 JavaScript 代码，这些代码会定时检查，当用户访问到被保护的 URL ，而且又不是会员时，我们让浏览器跳转到其他页面。这样就实现了保护。</p> <p>但实际上，内容其实已经到了浏览器中，只是没有显示，或者说显示的时间很短而已。通过查看 HTML 等方式，实际上是可以找到这些内容的。</p> <p>为了支持需要更为严格的保护用户内容的场景，MemberPrism 提供了基于代理的后端保护。</p> <p>后端保护的原理是，原来用户访问 <code>TargetSite</code>，现在改为访问 <code>ProxySite</code>，不再直接访问<code>TargetSite</code>。<code>ProxySite</code> 会先检查用户是否在访问会员内容，以及是否会员。如果权限不够，直接让其转向。</p> <p>区别在于，后端保护方案中，会员内容不会发送到浏览器，从而实现了真正意义上的保护。</p> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <p>进入 <code>PrismSite</code> 的 <code>Settings</code> 页面，拉到最下方。</p> <p>在 <code>Source site URL</code> 中填入 <code>TargetSite</code> 的 URL，在 <code>Proxy site URL</code> 中填入<code>ProxySite</code>  的 URL（也就是最终用户访问的 URL）。</p> <p>在支付等环节成功后，页面将重定向到 <code>Proxy site URL</code>，所以务必要正确填写。</p> <p><img src="/assets/img/43bd995595b8e51e9fe3eb9a0bf133e348b01336310e92530319197e9fddd701.d5e94f17.png" alt="picture 14"></p> <p>填写完成后，点击 <code>Save</code> 保存。页面刷新后，再点击 <code>Update proxy settings</code> 生成代理用的设置。以后每次更新代理相关功能，都需要手工点击一次。</p> <p>如果配置正确，用户应该可以通过 <code>Proxy site URL</code> 正常使用了。</p> <h3 id="安全"><a href="#安全" class="header-anchor">#</a> 安全</h3> <p>在前边的配置中，<code>TargetSite</code> 和 <code>ProxySite</code> 是可以同时被访问的。知道<code>TargetSite</code>网址的用户可能绕开后端保护。</p> <p>这里我们只需要给 <code>TargetSite</code> 加上 IP 访问限制，比如让其只能被 <code>ProxySite</code> 的 IP 访问，就可以防范以上的潜在问题。</p> <h2 id="更多"><a href="#更多" class="header-anchor">#</a> 更多</h2> <h3 id="关于作者"><a href="#关于作者" class="header-anchor">#</a> 关于作者</h3> <ul><li>个人主页：<a href="https://ftqq.com" target="_blank" rel="noopener noreferrer">https://ftqq.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>微博：<a href="https://weibo.com/easy" target="_blank" rel="noopener noreferrer">https://weibo.com/easy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Twitter：<a href="https://twitter.com/easychen" target="_blank" rel="noopener noreferrer">https://twitter.com/easychen<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.216dffaf.js" defer></script><script src="/assets/js/2.abbacd5f.js" defer></script><script src="/assets/js/3.752c41d5.js" defer></script>
  </body>
</html>
